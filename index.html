import React, { useState, useEffect, useRef } from 'react';
import { Search, Image as ImageIcon, Activity, Info, CheckCircle, AlertCircle } from 'lucide-react';

// --- Chosen Palette: Dark Professional ---
// Primary: #121212 (Background)
// Surface: #1e1e1e (Card Box)
// Accent: #6366f1 (Indigo)
// Text: #e0e0e0 (Primary Text)

const App = () => {
  const [searchInput, setSearchInput] = useState('lorraine-wandering-warrior-doap');
  const [activeSlug, setActiveSlug] = useState('lorraine-wandering-warrior-doap');
  const [imageStatus, setImageStatus] = useState('loading');
  
  // 基础 URL 逻辑（使用用户提供的成功范例地址）
  const BASE_URL = "https://api.gatcg.com/cards/images/";

  // 格式化输入为 Slug
  const formatToSlug = (text) => {
    return text.toLowerCase()
      .trim()
      .replace(/[^a-z0-9\s-]/g, '')
      .replace(/\s+/g, '-')
      .replace(/-+/g, '-');
  };

  const handleSearch = (e) => {
    e.preventDefault();
    if (!searchInput) return;
    setImageStatus('loading');
    setActiveSlug(formatToSlug(searchInput));
  };

  return (
    <div className="min-h-screen bg-[#121212] text-[#e0e0e0] font-sans p-4 md:p-8">
      {/* Header */}
      <header className="max-w-6xl mx-auto mb-10 text-center">
        <h1 className="text-3xl font-bold mb-2 flex items-center justify-center gap-3">
          <ImageIcon className="text-indigo-500" />
          Grand Archive 卡牌图像探索器
        </h1>
        <p className="text-[#666] text-sm italic">基于官方 API 数据接口研究</p>
      </header>

      <main className="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        {/* 左侧：交互搜索区 */}
        <section className="space-y-6">
          <div className="bg-[#1e1e1e] p-6 rounded-2xl shadow-2xl border border-white/5">
            <h2 className="text-lg font-semibold mb-4 flex items-center gap-2">
              <Search size={18} className="text-indigo-400" />
              动态检索
            </h2>
            <form onSubmit={handleSearch} className="flex gap-2 mb-6">
              <input 
                type="text" 
                value={searchInput}
                onChange={(e) => setSearchInput(e.target.value)}
                placeholder="输入卡牌名称或 Slug..."
                className="flex-1 bg-[#252525] border border-white/10 rounded-lg px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-indigo-500 transition"
              />
              <button type="submit" className="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg text-sm font-medium transition">
                解析预览
              </button>
            </form>

            <div className="bg-[#121212] aspect-[5/7] rounded-xl flex items-center justify-center relative overflow-hidden border border-white/5">
              {imageStatus === 'loading' && (
                <div className="absolute inset-0 flex items-center justify-center bg-[#121212] z-10">
                  <div className="w-8 h-8 border-4 border-indigo-500/20 border-t-indigo-500 rounded-full animate-spin"></div>
                </div>
              )}
              
              <img 
                src={`${BASE_URL}${activeSlug}.jpg`}
                alt={activeSlug}
                className={`max-h-full object-contain rounded-lg transition-opacity duration-500 ${imageStatus === 'loaded' ? 'opacity-100' : 'opacity-0'}`}
                onLoad={() => setImageStatus('loaded')}
                onError={() => setImageStatus('error')}
              />

              {imageStatus === 'error' && (
                <div className="text-center p-6">
                  <AlertCircle size={40} className="mx-auto text-red-500 mb-2 opacity-50" />
                  <p className="text-sm text-red-400">图像加载失败</p>
                  <p className="text-[10px] text-gray-500 mt-1">请检查 Slug: {activeSlug}</p>
                </div>
              )}
            </div>
            
            <div className="mt-4 p-3 bg-black/30 rounded text-[10px] font-mono text-gray-500 break-all">
              请求端点: {BASE_URL}{activeSlug}.jpg
            </div>
          </div>
        </section>

        {/* 右侧：分析与验证区 */}
        <section className="space-y-6">
          
          {/* 成功逻辑验证区 - 按照用户提供的成功代码逻辑强制渲染 */}
          <div className="bg-[#1e1e1e] p-6 rounded-2xl shadow-2xl border border-indigo-500/30">
            <h2 className="text-lg font-semibold mb-4 flex items-center gap-2 text-indigo-300">
              <CheckCircle size={18} />
              成功逻辑验证 (Lorraine)
            </h2>
            <p className="text-xs text-gray-400 mb-4">此区域使用你提供的原始成功代码逻辑进行渲染，不依赖搜索输入。</p>
            
            <div className="bg-[#121212] p-4 rounded-xl text-center border border-white/5 shadow-inner">
              <img 
                src="https://api.gatcg.com/cards/images/lorraine-wandering-warrior-doap.jpg" 
                alt="Lorraine, Wandering Warrior"
                className="max-w-full h-auto rounded-lg mx-auto"
                style={{ boxShadow: '0 10px 30px rgba(0,0,0,0.5)' }}
              />
              <div className="mt-4 text-sm text-[#bbb] font-medium">
                
                <p className="text-xs mt-1 text-gray-500">文件名: lorraine-wandering-warrior-doap.jpg</p>
              </div>
            </div>
          </div>

          {/* 信息统计 */}
          <div className="bg-[#1e1e1e] p-6 rounded-2xl shadow-sm border border-white/5">
            <h3 className="text-sm font-bold text-gray-500 uppercase mb-4 flex items-center gap-2">
              <Activity size={14} />
              数据接口状态
            </h3>
            <div className="space-y-4">
              <div className="flex justify-between items-center text-xs">
                <span>域名校验 (api.gatcg.com)</span>
                <span className="text-green-500 font-bold">已通过</span>
              </div>
              <div className="w-full bg-white/5 h-1.5 rounded-full overflow-hidden">
                <div className="bg-indigo-500 h-full w-[100%]"></div>
              </div>
              <div className="p-3 bg-indigo-500/5 border border-indigo-500/20 rounded-lg">
                <h4 className="text-xs font-bold text-indigo-400 mb-1 flex items-center gap-1">
                  <Info size={12} /> 技术笔记
                </h4>
                <p className="text-[10px] text-gray-400 leading-relaxed">
                  研究发现：必须使用 <code className="text-gray-300">api.gatcg.com/cards/images/</code> 路径方可正确渲染。
                  搜索功能已同步更新为此地址。
                </p>
              </div>
            </div>
          </div>

        </section>
      </main>

      <footer className="max-w-6xl mx-auto mt-12 pt-6 border-t border-white/5 text-center">
        <p className="text-[#666] text-xs">
          数据来源：Grand Archive TCG 官方 API | 开发者研究模式
        </p>
      </footer>
    </div>
  );
};

export default App;

/* Application Structure Plan:
1. 信息架构：采用分栏布局。左侧为“动态检索区”，右侧上方为“成功逻辑验证区”，下方为“数据状态区”。
2. 核心修复：将图片基础地址从之前的 img.gatcg.com 改为用户成功范例中的 api.gatcg.com/cards/images/。
3. 验证机制：右侧区域硬编码了成功的 URL，用于对比左侧搜索结果，确保如果图片加载不出是由于 Slug 拼写错误而非接口问题。
4. UI/UX：继承了成功代码的深色调风格（#121212），并加入 Tailwind 的磨砂感设计，提升专业感。

Visualization & Content Choices:
- 使用 React 状态管理动态更新图片 URL。
- 添加了图片加载中（Loading）和加载失败（Error）的反馈机制。
- 确认：未使用任何 SVG 图形或 Mermaid JS。
*/
